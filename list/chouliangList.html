<!doctype html>
<html lang="`en`">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>筹粮详情</title>
    <link rel="stylesheet" href="../css/mui.min.css">
    <link rel="stylesheet" href="../css/demo.css">
    <link rel="stylesheet" href="../css/List.css">
    <script src="../js/jquery-3.2.1.js"></script>
    <script src="../js/html2canvas.js"></script>
    <script src="../js/rem.js"></script>
    <script src="../js/mui.js"></script>
</head>
<body style="background: #f5f5f5;">
<div class="GrainRaising">
    <!--   banner  Start     -->
    <div class="GRList_banner">
        <div class="GRList_bannerImg">
            <img src="../images/banner.png" alt="">
        </div>
        <div class="GRList_bannerB">
            <div class="GRList_bannerBT">
                <div class="GRList_bannerBTT">
                    狗粮严重不足，请大家伸出援手帮帮我们
                </div>
                <div class="GRList_bannerBTB">
                    <div class="GRList_bannerBTB1">
                        <div class="GRList_bannerBTB1T">290</div>
                        <div class="GRList_bannerBTB1B">
                            <img src="../images/renshu.png" alt="">
                            <span>支持人数</span>
                        </div>
                    </div>
                    <div class="GRList_bannerBTB2"></div>
                    <div class="GRList_bannerBTB1">
                        <div class="GRList_bannerBTB1T">290</div>
                        <div class="GRList_bannerBTB1B">
                            <img src="../images/jine.png" alt="">
                            <span>已筹宠粮</span>
                        </div>
                    </div>
                    <div class="GRList_bannerBTB2"></div>
                    <div class="GRList_bannerBTB1">
                        <div class="GRList_bannerBTB1T">290</div>
                        <div class="GRList_bannerBTB1B">
                            <img src="../images/shijian.png" alt="">
                            <span>目标宠粮</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="GRList_bannerBB">
                <div class="GRList_bannerBBL">
                    <div id="demo1" class="mui-progressbar">
                        <span></span>
                    </div>
                </div>
                <div class="GRList_bannerBBR">20%</div>
            </div>
        </div>
    </div>
    <!--   banner  End     -->

    <!--   section  Start     -->
    <div class="GRList_One">
        <div class="GRList_One1">
            <div class="GRList_One1L">
                <div class="GRList_One1LL">筹粮故事</div>
                <div class="GRList_One1LR">
                    <a href="../ThreeLevelPage/Report.html">
                    <img src="../images/Tips.png" alt="">
                    <span>质疑/举报</span>
                    </a>
                </div>
            </div>
            <div class="GRList_One1R">
                发起时间：
                <span>2019-03-13</span>
            </div>
        </div>
        <div class="GRList_One2" id="content">
            欢喜小院成立于2013年3月，坐落于石家庄鹿泉一个村子里，基地占地七亩，共收容救助安置流浪犬800多只，是石家庄市收容流浪犬最大的基地！由于今年基地扩建，又恰逢遭遇前所未有的犬瘟疫情，花费巨资，导致债台高筑！现如今遭遇前所未有的粮荒，请大家力所能及帮帮我们，让毛孩子们吃饱饭，谢谢大家！
        </div>
        <ul class="GRList_One3">
            <li class="GRList_One3List">
                <img src="../images/GRList_One3List.png" alt="">
            </li>
            <li class="GRList_One3List">
                <img src="../images/GRList_One3List.png" alt="">
            </li>
            <li class="GRList_One3List">
                <img src="../images/GRList_One3List.png" alt="">
            </li>
            <li class="GRList_One3List">
                <img src="../images/GRList_One3List.png" alt="">
            </li>
            <li class="GRList_One3List">
                <img src="../images/GRList_One3List.png" alt="">
            </li>
            <li class="GRList_One3List">
                <img src="../images/GRList_One3List.png" alt="">
            </li>
        </ul>
        <div class="GRList_One4">
            <div class="GRList_One4_Top">
                <div class="GRList_One4_TopL">基地名称：欢喜流浪动物救助基地</div>
                <div class="GRList_One4_TopR">
                    <a href="../ThreeLevelPage/CheckBaseCertificate.html">查看认证</a>
                </div>
            </div>
            <div class="GRList_One4_Bottom">
                <div class="GRList_One4_BottomImg">
                    <img src="../images/adopt.png" alt="">
                </div>
                <div class="GRList_One4_BottomText">基地真实有效</div>
            </div>
        </div>
        <div class="GRList_One5">
            <div class="GRList_One5_Top">
                项目发起人：欢喜（13933196918）
            </div>
            <div class="GRList_One5_Bottom">
                <div class="GRList_One5_BottomB">
                    <div class="GRList_One4_BottomImg">
                        <img src="../images/adopt.png" alt="">
                    </div>
                    <div class="GRList_One4_BottomText">基地真实有效</div>
                </div>
                <div class="GRList_One5_BottomB">
                    <div class="GRList_One4_BottomImg">
                        <img src="../images/adopt.png" alt="">
                    </div>
                    <div class="GRList_One4_BottomText">基地真实有效</div>
                </div>
            </div>
        </div>
        <div class="GRList_One6">
            <div class="GRList_One5_Top">
                项目发起人：欢喜（13933196918）
            </div>
            <div class="GRList_One5_Bottom">
                <div class="GRList_One5_BottomB">
                    <div class="GRList_One4_BottomImg">
                        <img src="../images/adopt.png" alt="">
                    </div>
                    <div class="GRList_One4_BottomText">基地真实有效</div>
                </div>
                <div class="GRList_One5_BottomB">
                    <div class="GRList_One4_BottomImg">
                        <img src="../images/adopt.png" alt="">
                    </div>
                    <div class="GRList_One4_BottomText">基地真实有效</div>
                </div>
            </div>
        </div>
    </div>


    <div class="GRList_Two">
        <div class="GRList_Two_Title">
            捐赠宠粮记录
        </div>
        <ul class="GRList_Two_Ul">
            <li class="GRList_Two_UlLi">
                <div class="GRList_Two_UlLiL">
                    <img src="../images/find_Box1T_Img.png" alt="">
                </div>
                <div class="GRList_Two_UlLiR">
                    <div class="GRList_Two_UlLiRT">
                        大雄
                        <span>2019-03-24   09:50</span>
                    </div>
                    <div class="GRList_Two_UlLiRB">转赠宠粮 0.500kg; 德融善宠配赠 0.020kg</div>
                </div>
            </li>
            <li class="GRList_Two_UlLi">
                <div class="GRList_Two_UlLiL">
                    <img src="../images/find_Box1T_Img.png" alt="">
                </div>
                <div class="GRList_Two_UlLiR">
                    <div class="GRList_Two_UlLiRT">
                        大雄
                        <span>2019-03-24   09:50</span>
                    </div>
                    <div class="GRList_Two_UlLiRB">转赠宠粮 0.500kg; 德融善宠配赠 0.020kg</div>
                </div>
            </li>
            <li class="GRList_Two_UlLi">
                <div class="GRList_Two_UlLiL">
                    <img src="../images/find_Box1T_Img.png" alt="">
                </div>
                <div class="GRList_Two_UlLiR">
                    <div class="GRList_Two_UlLiRT">
                        大雄
                        <span>2019-03-24   09:50</span>
                    </div>
                    <div class="GRList_Two_UlLiRB">转赠宠粮 0.500kg; 德融善宠配赠 0.020kg</div>
                </div>
            </li>
            <li class="GRList_Two_UlLi">
                <div class="GRList_Two_UlLiL">
                    <img src="../images/find_Box1T_Img.png" alt="">
                </div>
                <div class="GRList_Two_UlLiR">
                    <div class="GRList_Two_UlLiRT">
                        大雄
                        <span>2019-03-24   09:50</span>
                    </div>
                    <div class="GRList_Two_UlLiRB">转赠宠粮 0.500kg; 德融善宠配赠 0.020kg</div>
                </div>
            </li>
            <li class="GRList_Two_UlLi">
                <div class="GRList_Two_UlLiL">
                    <img src="../images/find_Box1T_Img.png" alt="">
                </div>
                <div class="GRList_Two_UlLiR">
                    <div class="GRList_Two_UlLiRT">
                        大雄
                        <span>2019-03-24   09:50</span>
                    </div>
                    <div class="GRList_Two_UlLiRB">转赠宠粮 0.500kg; 德融善宠配赠 0.020kg</div>
                </div>
            </li>

        </ul>
    </div>
    <!--   section  End     -->
</div>

<div class="GRList_Tab">
    <div class="GRList_Tab_Share">
        <img src="../images/Share.png" alt="">
        <span>555</span>
    </div>
    <div class="GRList_Tab_Click">
        <a href="">去支持</a>
    </div>
</div>

<!--  Share  Start  -->
<div class="Share_PopupBox">
    <div class="Share_Popup">
        <ul class="Share_Popup_Top">
            <li class="Share_Popup_TopLi">
                <img src="../images/QQIcon.png" alt="">
                <span>QQ</span>
            </li>
            <li class="Share_Popup_TopLi">
                <img src="../images/WeChatIcon.png" alt="">
                <span>微信</span>
            </li>
            <li class="Share_Popup_TopLi">
                <img src="../images/FriendsIcon.png" alt="">
                <span>朋友圈</span>
            </li>
            <li class="Share_Popup_TopLi">
                <img src="../images/micro-blogIcon.png" alt="">
                <span>微博</span>
            </li>
            <li class="Share_Popup_TopLi">
                <img src="../images/WeChatIcon.png" alt="">
                <span>复制链接</span>
            </li>
            <li class="Share_Popup_TopLi" id="QRcode">
                <img src="../images/WeChatIcon.png" alt="">
                <span>生成二维码</span>
            </li>
        </ul>
        <div class="Share_Popup_Bottom">取消</div>
    </div>
</div>

<div class="QRcode_Box">
    <div class="QRcode">
        <div class="QRcode1">
            <img src="../images/QRcode1.png" alt="">
        </div>
        <div class="QRcode2">
            <img src="../images/QRcodebanner.png" alt="">
        </div>
        <div class="QRcode3">
            <div class="QRcode3L">
                <img src="../images/QRcode3L.png" alt="">
            </div>
            <div class="QRcode3C">
                <div class="QRcode3CT">我是大雄</div>
                <div class="QRcode3CB">我是第 <span>150</span> 位爱心接力人 邀你一起爱心传递</div>
            </div>
            <div class="QRcode3R">
                <img src="../images/QRcode3.png" alt="">
            </div>
        </div>
        <div class="QRcode4">
            <div class="QRcode4L">
                <img src="../images/QRcode4L.png" alt="">
            </div>
            <div class="QRcode4R">
                <div class="QRcode4RT">成为爱心接力人</div>
                <div class="QRcode4RB">长按或扫描二维码支持该项目</div>
            </div>

        </div>
        <img id="ossImg" src="" style="opacity: 0;width: 0;height: 0;">
    </div>

    <div class="QRcodeBtn">保存图片</div>
</div>
<div class="share_Box">
    <div class="share_Box1">点击右上角的“ <div class="share_Box1yuan"></div><div class="share_Box1yuan"></div><div class="share_Box1yuan"></div>”</div>
    <div class="share_Box2">分享到朋友圈或微信好友</div>
    <div class="share_Box3">或分享至</div>

    <div class="share_Box4">
        <div class="share_Box4L">
            <div class="share_Box4LImg"><img src="../images/share1.png" alt="" style=" width: 0.45rem;height: 0.46rem;"></div>
            <span>QQ好友</span>
        </div>
        <div class="share_Box4R">
            <div class="share_Box4LImg">
                <img src="../images/share2.png" alt="" style="width: 0.52rem;height: 0.46rem;">
            </div>
            <span>QQ空间</span>
        </div>
    </div>
    <div class="share_Box5">
        <div class="share_Box4L">
            <div class="share_Box4LImg"><img src="../images/share3.png" alt="" style="width: 0.54rem;height: 0.43rem;"></div>
            <span>新浪微博</span>
        </div>
        <div class="share_Box4R">
            <div class="share_Box4LImg">
                <img src="../images/share4.png" alt="" style="width: 0.4rem;height: 0.4rem;">
            </div>
            <span>二维码</span>
        </div>
    </div>

    <div class="share_Box6"></div>

    <div class="share_Box7">取消</div>

</div>
<!--  Share  end  -->

<script>
    //初始化进度条
    mui("#demo1").progressbar({progress: 20}).show();
    //点击查看更多文字
    (function init() {
        var len = 60;      //默认显示字数
        var ctn = document.getElementById("content");  //获取div对象
        var content = ctn.innerHTML;                   //获取div里的内容

        //alert(content);
        var span = document.createElement("span");     //创建<span>元素
        var a = document.createElement("a");           //创建<a>元素
        span.innerHTML = content.substring(0, len);     //span里的内容为content的前len个字符

        a.innerHTML = content.length > len ? "... 展开" : "";  ////判断显示的字数是否大于默认显示的字数    来设置a的显示
        a.href = "javascript:void(0)";//让a链接点击不跳转

        a.ontouchstart = function () {
            if (a.innerHTML.indexOf("展开") > 0) {      //如果a中含有"展开"则显示"收起"
                a.innerHTML = "收起";
                span.innerHTML = content;
            } else {
                a.innerHTML = "&nbsp;&nbsp;展开";
                span.innerHTML = content.substring(0, len);
            }
        }
        // 设置div内容为空，span元素 a元素加入到div中
        ctn.innerHTML = "";
        ctn.appendChild(span);
        ctn.appendChild(a);
    })();
    //点击分享弹出
    (function shareup() {
        var shareBtn = document.querySelector(".GRList_Tab_Share");
        var shareBox = document.querySelector(".Share_PopupBox");
        var share = document.querySelector(".Share_Popup");
        var close = document.querySelector(".Share_Popup_Bottom");

        shareBtn.ontouchstart = function () {
            shareBox.style.cssText = "opacity: 1;z-index:9;";
            share.style.cssText = "bottom: 0;";
        };
        close.ontouchstart = function () {
            shareBox.style.cssText = "opacity: 0;z-index:-9; ";
            share.style.cssText = "bottom: -10rem;"
        };
    })();
    //生成二维码
    (function generate() {
        var qrcode = document.querySelector("#QRcode");
        var qrcodeBox = document.querySelector(".QRcode_Box");
        qrcode.ontouchstart = function () {
            qrcodeBox.style.cssText = "z-index:9;opacity:1;";
        };
    })();



    //生成图片
    $(".QRcodeBtn").on("click",function img() {

        var c_width = $('.QRcode').outerWidth();
        //如果box设置了padding，需要获取outerWidth和outerHeight来赋给canvas；
        var c_height =$('.QRcode').outerHeight();

        var canvas = document.createElement("canvas");
        var context = canvas.getContext("2d");

        //以下代码是获取根据屏幕分辨率，来设置canvas的宽高以获得高清图片
        // 屏幕的设备像素比
        var devicePixelRatio = window.devicePixelRatio || 2;

        // 浏览器在渲染canvas之前存储画布信息的像素比
        var backingStoreRatio = context.webkitBackingStorePixelRatio ||
            context.mozBackingStorePixelRatio ||
            context.msBackingStorePixelRatio ||
            context.oBackingStorePixelRatio ||
            context.backingStorePixelRatio || 1;

        // canvas的实际渲染倍率
        var ratio = devicePixelRatio/backingStoreRatio;

        canvas.width = c_width * ratio;
        canvas.height = c_height * ratio;
        canvas.style.width = c_width + "px";
        canvas.style.height = c_height + "px";

        var transTop = $(document).scrollTop() - $('.QRcode').offset().top;
        //获取div垂直方向的位置

        context.scale(ratio,ratio);
        context.translate((c_width-$(window).width())/2,transTop)
        //canvas的位置要保证与div位置相同。

        //高清图设置完成

        //解决跨域，将跨域图片路径转为base64格式
        var img = new Image();
        var canvas2 = document.createElement('canvas');
        var ctx = canvas2.getContext('2d');
        img.crossOrigin = 'Anonymous';
        img.src=$('#ossImg').attr('src');
        img.onload = function () {
            canvas2.height = img.height;
            canvas2.width = img.width;
            ctx.drawImage(img, 0, 0);
            var dataURL = canvas2.toDataURL('image/png');
            $('#ossImg').attr('src',dataURL);
            canvas2 = null;

            //重新给img赋值成功后，执行截图方法
            getCard()

        };

        function getCard(){
            html2canvas($(".QRcode_Box"),{
                allowTaint:true,
                useCORS:true,
                canvas:canvas,
                onrendered:function(canvas){
                    dataURL =canvas.toDataURL("image/png");
                    var img = new Image();
                    img.src=dataURL;
                    img.className = 'cardImg';
                    // img.css("width","6.9rem","height","9rem");
                    img.width=100+'px';
                    img.height=200+'px';
                    img.onload = function () {
                        $(".QRcode_Box").append(img);
                        $(".QRcode").css("opactiy","0");
                        // console.log(img);
                    }
                },
                width:c_width,
                height:c_height
            })
        };
        getCard();
    })

</script>

</body>
</html>